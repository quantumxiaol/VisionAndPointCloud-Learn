# 两平面相交
## RANSAC介绍
RANSAC算法的基本原理
RANSAC是一种迭代方法，用于从一组观测数据中估计数学模型参数，其中观测数据可能包含大量的噪声或异常值（离群点）。
其核心思想是从数据集中随机选择最小数量的数据点以估计一个模型，并通过计算其他数据点与该模型之间的距离来确定内点（符合模型的数据点）和外点（不符合模型的数据点）。
这个过程重复进行多次，直到找到一个最佳模型，即具有最多内点的模型。

RANSAC 通过反复选择数据中的一组随机子集来达成目标。被选取的子集被假设为局内点，并用下述方法进行验证：

一个模型适用于假设的局内点，即所有的未知参数都能从假设的局内点计算得出。

用上面得到的模型去测试所有的其它数据，如果某个点适用于估计的模型，认为它也是局内点。

如果有足够多的点被归类为假设的局内点，那么估计的模型就足够合理。

然后，用所有假设的局内点去重新估计模型，因为它仅仅被初始的假设局内点估计过。

最后，通过估计局内点与模型的错误率来评估模型。

这个过程被重复执行固定的次数，每次产生的模型要么因为局内点太少而被舍弃，要么因为它比现有的模型更好而被选用。

N：样本个数

K：求解模型需要的最少的点的个数（对于直线拟合来说就是两个点，对于平面拟合来说就是三个点，对于计算Homography矩阵就是四个点）

随机采样K个点

对该K个点拟合模型

计算其他点到拟合模型的距离。如果小于一定阈值，该点被当作内点，统计内点个数

将上面步骤重复M次，选择内点数最多的模型

利用所有的内点重新估计模型（可选）

迭代的次数，是可以估算出来的。假设“内点”在数据中的占比为p：

能采样到正确的K个点去计算出正确模型的概率是：

z = 1 - (1-p^K)^M

## 计算平面方程

首先，创建一个SACSegmentation对象seg，设置模型类型为SACMODEL_PLANE，方法类型为SAC_RANSAC，最大迭代次数为50000，距离阈值为12。

然后，创建一个指向输入点云的指针remainingCloud，一个指向点云中的内点的指针inliers，一个指向模型系数的指针coefficients。

接下来，对于每个平面，调用SACSegmentation::segment()方法，提取出内点和模型系数。

如果内点的数量小于100，说明无法估计给定数据集的平面模型，函数返回。

将模型系数存储到planeCoefficients中，并创建一个ExtractIndices对象extract，设置输入点云为remainingCloud，内点为inliers。

调用extract.filter()方法，将内点从remainingCloud中提取出来。

如果planeCoefficients的大小小于2，说明在点云中找不到至少两个平面，函数返回。

调用computePlaneIntersection()函数，计算两个平面的交线，将结果存储到linePoint和lineDirection中。

## 计算交线

从给定的平面方程（以齐次坐标表示）中提取出法向量normal1和normal2。

然后，计算这两个法向量的叉乘得到交线的方向向量direction。

如果方向向量的范数为零，这意味着两个平面平行或重合，因此没有唯一的交线，函数返回false。

接下来，创建一个3x3矩阵，其中包含两个法向量和平行于交线的方向向量。

计算常数向量constants，其中包含了平面方程中的常数项（以负号表示）和一个零元素（对应于交线方向向量）。

使用QR分解求解矩阵方程Ax = b，其中A是包含法向量和方向向量的矩阵，b是常数向量。这将给出位于交线上的点point。

将计算出的点赋值给linePoint，并将方向向量规范化后赋值给lineDirection。

## 计算交点

点云是有范围的，因此可以计算实际的交点。

将小块点云的点投射到交线上，记录极端值，即为交点。
